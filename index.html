<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>N5 Flashcards — Lilac Mobile</title>
<style>
  :root{
    --lilac:#b79df4;
    --lilac-2:#e9e2ff;
    --lilac-3:#f5f1ff;
    --ink:#1f2630;
    --ok:#29b36a;
    --bad:#e14b4b;
    --shadow: 0 10px 30px rgba(0,0,0,.08);
    --radius:18px;
  }
  html, body {height:100%; margin:0; padding:0; overflow:hidden; background:
    radial-gradient(1200px 600px at 0% 100%, var(--lilac-2), transparent 60%),
    radial-gradient(1200px 600px at 100% 0%, var(--lilac-2), transparent 60%),
    var(--lilac-3);
    -webkit-tap-highlight-color: transparent;
    font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    color:var(--ink);
  }

  /* App layout */
  .app{
    height: calc(100svh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
    padding:
      calc(8px + env(safe-area-inset-top))
      calc(12px + env(safe-area-inset-right))
      calc(12px + env(safe-area-inset-bottom))
      calc(12px + env(safe-area-inset-left));
    display:flex; flex-direction:column; gap:12px; box-sizing:border-box;
  }

  .header{
    display:flex; align-items:center; justify-content:space-between;
    padding:6px 10px; border-radius:12px;
  }
  .brand{ display:flex; align-items:center; gap:10px; font-weight:700; letter-spacing:.2px;}
  .badge{background:var(--lilac); color:#fff; width:36px; height:36px; border-radius:10px; display:grid; place-items:center; font-weight:800; box-shadow: var(--shadow);}
  .brand span{opacity:.9}

  .stage{ flex:1 1 auto; display:flex; flex-direction:column; align-items:center; gap:10px; }

  .card-wrap{
    position:relative; flex:1 1 auto; width:100%;
    display:grid; place-items:center;
  }
  .card{
    width:min(980px, 95vw);
    height:min(56svh, 66vw); /* ดูดีทั้งแนวตั้ง/แนวนอน */
    background: #fff;
    border-radius: calc(var(--radius) + 6px);
    box-shadow: var(--shadow), inset 0 0 0 1px rgba(0,0,0,.03);
    display:grid; place-items:center;
    padding: 12px; box-sizing:border-box;
    font-weight:800; font-size: clamp(28px, 6.2vw, 64px);
    transform: translate3d(0,0,0);
    transition: transform .25s ease, background-color .25s ease, box-shadow .25s ease;
    user-select:none;
    text-align:center;
  }
  .card.knew   { background: #f2fbf6; box-shadow: var(--shadow), 0 0 0 4px rgba(41,179,106,.15) inset; }
  .card.dk     { background: #fff5f5; box-shadow: var(--shadow), 0 0 0 4px rgba(225,75,75,.15) inset; }

  .sub{
    position:absolute; bottom:10px; left:0; right:0;
    font-size: clamp(13px, 2.6vw, 16px); opacity:.7; font-weight:500;
  }

  /* Buttons row */
  .actions{
    display:grid; grid-template-columns:1fr 1fr; gap:12px;
    width:min(960px, 96vw); margin: 0 auto;
  }
  .btn{
    padding:16px 18px; border-radius:20px; border:none; cursor:pointer; font-weight:800;
    font-size: clamp(15px, 3.8vw, 18px);
    color:#fff; box-shadow: var(--shadow);
    transition: transform .12s ease, filter .12s ease, opacity .12s ease, background .2s ease;
    touch-action: manipulation;
  }
  .btn:active{ transform: translateY(1px) scale(.99); filter:brightness(.98) }
  .btn-ok{ background: var(--ok); }
  .btn-bad{ background: var(--bad); }

  .footer { text-align:center; font-size:12px; opacity:.55; padding-top:4px;}

  /* Flip states */
  .face-front{ display:block; }
  .face-back { display:none; font-weight:600 }
  .flipped .face-front{ display:none }
  .flipped .face-back { display:block }

  /* swipe hint overlay (subtle) */
  .hint{
    position:absolute; inset:0; pointer-events:none; border-radius: inherit;
    background: linear-gradient(90deg, rgba(41,179,106,.08), transparent 35%, transparent 65%, rgba(225,75,75,.08));
  }
</style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="brand">
        <div class="badge">N5</div>
        <span>N5 Flashcards</span>
      </div>
      <div style="font-size:13px;opacity:.65" id="meta"></div>
    </div>

    <div class="stage">
      <div class="card-wrap">
        <div class="card" id="card">
          <div>
            <div class="face-front" id="front">Loading…</div>
            <div class="face-back"  id="back"></div>
          </div>
          <div class="hint"></div>
          <div class="sub" id="sub"></div>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-ok"  id="btnKnow">✓ Know</button>
        <button class="btn btn-bad" id="btnDont">✗ Don’t know</button>
      </div>

      <div class="footer">Tip: tap to flip · swipe right = Know, left = Don’t know</div>
    </div>
  </div>

<script>
/* 1) ตั้งลิงก์ JSON จาก GitHub (ปุ่ม RAW)
   ตัวอย่าง:
   https://raw.githubusercontent.com/pongpipatt/jp-n5-n4-flashcards/main/n5-n4-core-1000.json
*/
const DATA_URL = 'https://raw.githubusercontent.com/USERNAME/REPO/BRANCH/n5-n4-core-1000.json';

// ====== State ======
let cards = []; // {front, back, raw}
let idx = 0;
let flipped = false;
let stats = {known:0, unknown:0};
let touchStartX = 0, touchStartY = 0, swiping = false;

// ====== Helpers ======
const el = id => document.getElementById(id);
const $card = el('card'), $front = el('front'), $back = el('back'), $sub = el('sub'), $meta = el('meta');

function normalizeRow(r){
  const front = r.kanji || r.kana || r.word || '';
  const back  = `
    <div style="font-size:clamp(15px,3.8vw,18px);opacity:.9;margin-bottom:6px">${r.kana || ''}</div>
    <div style="font-size:clamp(13px,3.4vw,16px);opacity:.8">${r.romaji || ''}</div>
    <div style="font-size:clamp(14px,3.6vw,17px);margin-top:8px">${r.meaning || r.thai || ''}</div>
  `.trim();
  const sub   = `${r.pos? r.pos+' · ' : ''}${r.tags || ''}`;
  return { front: front || '—', back, sub, raw:r };
}

function render(){
  const c = cards[idx];
  if(!c){ $front.textContent='No cards'; $back.textContent=''; return; }
  $front.textContent = c.front;
  $back.innerHTML    = c.back;
  $sub.textContent   = c.sub;
  $meta.textContent  = `#${idx+1}/${cards.length} · Known ${stats.known} · Unknown ${stats.unknown}`;
  setFlipped(false);
}

function setFlipped(f){
  flipped = f;
  $card.classList.toggle('flipped', flipped);
}

function nextCard(){
  // เลือกการ์ดถัดไปแบบสุ่มถ่วงน้ำหนักเล็กน้อย
  idx = (idx + 1) % cards.length;
  render();
}

// ====== Actions ======
function onKnow(){
  stats.known++;
  flashTint('ok');
  nextCard();
}
function onDont(){
  stats.unknown++;
  flashTint('bad');
  // ถ้ายังจำไม่ได้ เอาใบนี้สลับไปท้ายกอง
  const cur = cards[idx];
  cards.splice(idx,1);
  cards.push(cur);
  if(idx >= cards.length) idx = 0;
  nextCard();
}

function flashTint(type){
  $card.classList.remove('knew','dk');
  void $card.offsetWidth; // restart transition
  if(type==='ok') $card.classList.add('knew');
  if(type==='bad') $card.classList.add('dk');
  // slide animation
  $card.style.transition = 'transform .22s ease, background-color .25s ease, box-shadow .25s ease';
  $card.style.transform = `translateX(${type==='ok'?'+80':'-80'}px)`;
  setTimeout(()=>{$card.style.transform='translateX(0)';}, 180);
}

// ====== Touch / Swipe ======
$card.addEventListener('touchstart', e=>{
  const t = e.changedTouches[0];
  touchStartX = t.clientX; touchStartY = t.clientY; swiping = true;
},{passive:true});

$card.addEventListener('touchmove', e=>{
  if(!swiping) return;
  const t = e.changedTouches[0];
  const dx = t.clientX - touchStartX;
  const dy = t.clientY - touchStartY;
  // จำกัดให้ลากได้เล็กน้อยเป็นฟีดแบ็ก
  $card.style.transform = `translateX(${Math.max(Math.min(dx,90),-90)}px) rotate(${dx/90*2}deg)`;
},{passive:true});

$card.addEventListener('touchend', e=>{
  if(!swiping) return;
  swiping = false;
  const t = e.changedTouches[0];
  const dx = t.clientX - touchStartX;
  const dy = t.clientY - touchStartY;
  $card.style.transform = 'translateX(0) rotate(0)';
  const TH = 60; // threshold
  // ถ้าไม่ถึง threshold ให้ถือว่า tap => flip
  if (Math.abs(dx) < TH && Math.abs(dy) < 40) { setFlipped(!flipped); return; }
  if (dx > TH) onKnow();
  else if (dx < -TH) onDont();
});

// Desktop click = flip
$card.addEventListener('click', ()=> setFlipped(!flipped));

// Buttons
document.getElementById('btnKnow').addEventListener('click', onKnow);
document.getElementById('btnDont').addEventListener('click', onDont);

// ====== Boot ======
(async function init(){
  try{
    const res = await fetch(DATA_URL, {cache:'no-store'});
    const raw = await res.json();
    // รองรับทั้ง array เดียว หรือ object ที่มี data
    const arr = Array.isArray(raw) ? raw : (raw.data || []);
    cards = arr.map(normalizeRow).filter(x=>x.front && (x.raw.meaning || x.raw.thai));
    // สุ่มลำดับเริ่มต้นเล็กน้อย
    for(let i=cards.length-1;i>0;i--){ const j = Math.floor(Math.random()*(i+1)); [cards[i],cards[j]]=[cards[j],cards[i]]; }
    idx = 0; stats = {known:0, unknown:0};
    render();
  }catch(err){
    $front.textContent = 'Failed to load data';
    console.error(err);
  }
})();
</script>
</body>
</html>
