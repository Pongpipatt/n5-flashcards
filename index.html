<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>JLPT N5 Flashcards</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Sans+JP:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#F7F9FC;
      --card:#FFFFFF;
      --ink:#0F172A;
      --sub:#5B667A;
      --muted:#8B98B7;
      --ring:#DCE6F9;
      --chip:#EDF4FF;
      --chip-b:#E7ECF7;
      --ok:#22C55E;
      --ng:#EF4444;
      --ok-press:#16A34A;
      --ng-press:#DC2626;
      --brand:#2F80ED;
      --shadow:0 10px 24px rgba(15,23,42,.10);
    }
    * { box-sizing: border-box }
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Thai",sans-serif;
      -webkit-tap-highlight-color: transparent;
    }
    .page{
      max-width:980px; margin:0 auto; padding:16px clamp(12px,3vw,24px) 100px;
      /* bottom padding ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÅ‡∏ñ‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏•‡πà‡∏≤‡∏á */
    }
    /* Header */
    .topbar{ display:flex; align-items:center; gap:12px; }
    .back{
      width:44px; height:44px; display:grid; place-items:center; border-radius:12px;
      background:var(--card); box-shadow: var(--shadow); border:1px solid var(--ring); cursor:pointer;
      user-select:none; touch-action:manipulation;
    }
    .brand{ display:flex; flex-direction:column }
    .brand h1{
      font-size:22px; line-height:1.2; margin:0; font-weight:800;
      letter-spacing:.2px;
    }
    .brand small{ color:var(--sub) }
    .spacer{ flex:1 }
    .pill{
      background:var(--card); border:1px solid var(--ring); box-shadow:var(--shadow);
      border-radius:16px; padding:10px 14px; display:flex; align-items:center; gap:8px; user-select:none;
      cursor:pointer; touch-action:manipulation;
    }
    .pill strong{ font-weight:800 }

    /* Filter chips row */
    .chips{ display:flex; gap:10px; flex-wrap:wrap; margin:14px 0 8px }
    .chip{
      padding:8px 12px; border-radius:999px; background:var(--chip); border:1px solid var(--chip-b);
      font-weight:600; color:#35507a; cursor:pointer; user-select:none; touch-action:manipulation;
    }
    .chip.is-on{ background:#DBEAFE; border-color:#C7DBFF }

    /* Card */
    .card-wrap{ display:grid; place-items:center; margin-top:8px }
    .card, #flashcard, #card{
      width:min(760px,92vw);
      aspect-ratio:16/9; min-height:260px;
      background:var(--card); border-radius:18px; box-shadow:var(--shadow);
      position:relative; overflow:hidden; transform-style:preserve-3d;
      transition:transform .5s cubic-bezier(.2,.8,.2,1), box-shadow .2s;
      will-change:transform;
      border:1px solid var(--ring);
    }
    .card:active{ box-shadow:0 6px 18px rgba(15,23,42,.12) }
    .card-face{ position:absolute; inset:0; padding:28px 24px;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      backface-visibility:hidden;
    }
    .card.flipped{ transform:rotateY(180deg) }
    .card-back{ transform:rotateY(180deg) }

    .word-kanji{
      font-family:"Noto Sans JP", Inter, sans-serif; font-weight:800;
      font-size: clamp(48px, 7vw, 76px); line-height:1.1;
    }
    .word-kana{
      font-family:"Noto Sans JP", Inter, sans-serif; font-weight:600;
      margin-top:6px; color:var(--sub); font-size: clamp(18px, 2.6vw, 24px);
    }
    .word-romaji{ color:var(--muted); margin-top:2px; font-size: 16px }
    .meaning{ font-size: clamp(22px, 2.8vw, 28px); font-weight:800; text-align:center }
    .meta{ margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center }
    .meta-badge{ background:var(--chip); border:1px solid var(--chip-b); padding:6px 10px; border-radius:999px; font-size:12px }

    /* Motion for change */
    @keyframes enterUp { from{ transform:translateY(8px); opacity:.0 } to{ transform:translateY(0); opacity:1 } }
    @keyframes leaveUp { from{ transform:translateY(0); opacity:1 } to{ transform:translateY(-8px); opacity:0 } }
    .enter{ animation:enterUp .22s ease-out }
    .leave{ animation:leaveUp .18s ease-in }

    /* Flip button (full width) */
    .flip-bar{
      width:min(760px,92vw); margin:12px auto 8px;
      background:var(--card); border:1px solid var(--ring); border-radius:14px;
      box-shadow: var(--shadow); padding:12px 16px; text-align:center; font-weight:800; color:#3a516e;
      user-select:none; cursor:pointer; touch-action:manipulation;
    }

    /* Bottom action bar (fixed) */
    .bottom-bar{
      position:fixed; left:0; right:0; bottom:0; z-index:30;
      background:linear-gradient(180deg, rgba(247,249,252,0) 0%, var(--bg) 18%, var(--bg) 100%);
      padding:18px clamp(12px,3vw,24px) calc(12px + env(safe-area-inset-bottom, 8px));
      display:flex; flex-direction:column; gap:12px; align-items:center;
    }
    .actions{ display:flex; gap:14px; width:min(760px,92vw) }
    .btn{
      flex:1; padding:16px 18px; border-radius:14px;
      color:#fff; font-weight:800; text-align:center; border:none; cursor:pointer; touch-action:manipulation;
      box-shadow:var(--shadow);
    }
    .btn-ok{ background:var(--ok) }
    .btn-ok:active{ background:var(--ok-press) }
    .btn-ng{ background:var(--ng) }
    .btn-ng:active{ background:var(--ng-press) }

    .row{ display:flex; gap:12px; width:min(760px,92vw); justify-content:space-between; flex-wrap:wrap }
    .ghost{
      background:var(--card); border:1px solid var(--ring); color:#2b466a;
      padding:12px 14px; border-radius:12px; box-shadow:var(--shadow); font-weight:700;
      cursor:pointer; user-select:none; touch-action:manipulation;
    }

    /* progress bubble */
    .progress{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      border:1px solid var(--ring); border-radius:14px; padding:10px 14px; background:var(--card); box-shadow:var(--shadow);
      font-weight:800;
    }

    /* Avoid mobile Safari pinch zoom on double tap */
    button, .ghost, .pill, .chip, .flip-bar { touch-action: manipulation; }
  </style>
</head>
<script>
/* --------------------- Data loading --------------------- */
/** ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö 3 ‡πÅ‡∏ö‡∏ö:
 * 1) ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ global WORDS ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏¢
 * 2) ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‚Üí ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° fetch ‡πÑ‡∏ü‡∏•‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢
 * 3) ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‚Üí ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á sample 3 ‡∏Ñ‡∏≥
 */
const candidateUrls = [
  'n5-flashcards-500-word.json',
  'n5-500 word.json',
  'n5-500-word.json',
  'words.json'
];

async function loadWords(){
  if (Array.isArray(window.WORDS) && window.WORDS.length) return window.WORDS;

  for (const u of candidateUrls){
    try{
      const res = await fetch(u);
      if(!res.ok) continue;
      const data = await res.json();
      if(Array.isArray(data) && data.length) return data;
      if(Array.isArray(data.vocab)) return data.vocab; // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏°‡∏µ key vocab
    }catch(e){}
  }
  // fallback ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
  return [
    {kanji:'Áä¨', kana:'„ÅÑ„Å¨', romaji:'inu', meaning:'‡∏™‡∏∏‡∏ô‡∏±‡∏Ç', level:'N5', category:'‡∏™‡∏±‡∏ï‡∏ß‡πå'},
    {kanji:'Ë°å„Åè', kana:'„ÅÑ„Åè', romaji:'iku', meaning:'‡πÑ‡∏õ', level:'N5', category:'‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á'},
    {kanji:'Áîò„ÅÑ', kana:'„ÅÇ„Åæ„ÅÑ', romaji:'amai', meaning:'‡∏´‡∏ß‡∏≤‡∏ô', level:'N5', category:'‡∏≠‡∏≤‡∏´‡∏≤‡∏£'}
  ];
}

/* --------------------- State --------------------- */
let ALL = [];
let filtered = [];
let idx = 0;
let known = new Set();
let unknown = new Set();
let actCategory = null;

/* --------------------- Helpers --------------------- */
const $ = s => document.querySelector(s);
const byId = s => document.getElementById(s);

const cardEl = byId('card');
const el = {
  kanji:   byId('c-kanji'),
  kana:    byId('c-kana'),
  romaji:  byId('c-romaji'),
  meaning: byId('c-meaning'),
  level:   byId('c-level'),
  cat:     byId('c-category'),
  prCur:   byId('prCur'),
  prAll:   byId('prAll'),
  chips:   byId('chipRow'),
};

function clamp(n,min,max){ return Math.max(min, Math.min(max,n)) }
function updateProgress(){
  el.prCur.textContent = filtered.length ? (idx+1) : 0;
  el.prAll.textContent = filtered.length;
}

function renderCard(data){
  if(!data) return;
  el.kanji.textContent   = data.kanji   || '';
  el.kana.textContent    = data.kana    || '';
  el.romaji.textContent  = data.romaji  || '';
  el.meaning.textContent = data.meaning || data.thai || '';
  el.level.textContent   = data.level   || data.jlpt || 'N5';
  el.cat.textContent     = data.category || data.type || '';
  updateProgress();
}

function animateChange(updateFn){
  cardEl.classList.remove('enter');
  cardEl.classList.add('leave');
  setTimeout(()=>{
    updateFn();
    cardEl.classList.remove('leave');
    void cardEl.offsetWidth; // reflow
    cardEl.classList.add('enter');
  }, 160);
}

function go(delta){
  if(!filtered.length) return;
  idx = clamp(idx + delta, 0, filtered.length-1);
  cardEl.classList.remove('flipped');
  animateChange(()=> renderCard(filtered[idx]));
}

function shuffle(){
  for (let i = filtered.length-1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [filtered[i], filtered[j]] = [filtered[j], filtered[i]];
  }
  idx = 0;
  cardEl.classList.remove('flipped');
  animateChange(()=> renderCard(filtered[idx]));
}

function applyFilter(category){
  actCategory = category || null;
  filtered = actCategory ? ALL.filter(w => (w.category||w.type) === actCategory) : [...ALL];
  if(!filtered.length){ idx = 0; renderCard({kanji:'',kana:'',romaji:'',meaning:'‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥',level:'',category:''}); updateProgress(); return; }
  idx = 0;
  cardEl.classList.remove('flipped');
  renderCard(filtered[0]);
}

/* --------------------- UI bindings --------------------- */
function bindUI(){
  // flip by card tap + bar
  const toggle = ()=> cardEl.classList.toggle('flipped');
  byId('btnFlip').addEventListener('click', toggle);
  cardEl.addEventListener('click', toggle);

  byId('btnPrev').addEventListener('click', ()=> go(-1));
  byId('btnNext').addEventListener('click', ()=> go(1));
  byId('btnShuffle').addEventListener('click', shuffle);

  byId('btnKnow').addEventListener('click', ()=>{
    const cur = filtered[idx]; if(!cur) return;
    unknown.delete(cur._id); known.add(cur._id); go(1);
  });
  byId('btnDont').addEventListener('click', ()=>{
    const cur = filtered[idx]; if(!cur) return;
    known.delete(cur._id); unknown.add(cur._id); go(1);
  });

  byId('btnBack').addEventListener('click', ()=> history.length>1 ? history.back() : window.location.href = './');
  byId('btnSettings').addEventListener('click', ()=> alert('Settings ‡∏à‡∏∞‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡πÄ‡∏£‡πá‡∏ß ‡πÜ ‡∏ô‡∏µ‡πâ üëÄ'));
  byId('btnFilter').addEventListener('click', ()=> {
    if(!ALL.length) return;
    // toggle ‚Äú‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‚Äù
    applyFilter(actCategory ? null : (ALL[0].category||ALL[0].type));
  });
  byId('btnStats').addEventListener('click', ()=>{
    const k = known.size, u = unknown.size;
    alert(`‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤\n‡∏£‡∏π‡πâ‡πÅ‡∏•‡πâ‡∏ß: ${k} ‡∏Ñ‡∏≥\n‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ: ${u} ‡∏Ñ‡∏≥\n‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î(‡∏ô‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ): ${filtered.length} ‡∏Ñ‡∏≥`);
  });
}

/* ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏¥‡∏õ‡∏´‡∏°‡∏ß‡∏î */
function buildChips(){
  const cats = [...new Set(ALL.map(w=> w.category || w.type || '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'))].sort();
  el.chips.innerHTML = '';
  const btnAll = document.createElement('div');
  btnAll.className = 'chip' + (!actCategory ? ' is-on' : '');
  btnAll.textContent = '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
  btnAll.onclick = ()=>{ document.querySelectorAll('.chip').forEach(c=>c.classList.remove('is-on')); btnAll.classList.add('is-on'); applyFilter(null); };
  el.chips.appendChild(btnAll);

  cats.forEach(c=>{
    const d = document.createElement('div');
    d.className = 'chip' + (actCategory===c ? ' is-on' : '');
    d.textContent = c;
    d.onclick = ()=>{
      document.querySelectorAll('.chip').forEach(c=>c.classList.remove('is-on'));
      d.classList.add('is-on');
      applyFilter(c);
    };
    el.chips.appendChild(d);
  });
}

/* --------------------- Bootstrap --------------------- */
(async function init(){
  ALL = await loadWords();

  // normalize + id
  ALL = ALL.map((w,i)=>({
    ...w,
    _id: i,
    // map ‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏∑‡πà‡∏ô
    kanji:   w.kanji   ?? '',
    kana:    w.kana    ?? '',
    romaji:  w.romaji  ?? '',
    meaning: w.meaning ?? w.thai ?? '',
    level:   w.level   ?? w.jlpt ?? 'N5',
    category:w.category?? w.type ?? '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'
  }));

  filtered = [...ALL];
  bindUI();
  buildChips();
  updateProgress();
  renderCard(filtered[0]);
})();
</script>
</body>
</html>
<body>
  <div class="page">
    <!-- Top bar -->
    <div class="topbar">
      <div class="back" id="btnBack" title="‡∏Å‡∏•‡∏±‡∏ö">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M15 19l-7-7 7-7" stroke="#2B3E5C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="brand">
        <h1>JLPT N5 <span style="font-weight:700">Flashcards</span></h1>
        <small>‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î + ‡∏à‡∏î‡∏à‡∏≥‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏ß‡πà‡∏≥‡∏´‡∏ô‡πâ‡∏≤ (‡πÅ‡∏ï‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏•‡∏¥‡∏Å)</small>
      </div>
      <div class="spacer"></div>
      <div id="progress" class="pill"><strong id="prCur">0</strong>/<span id="prAll">0</span></div>
      <div id="btnSettings" class="pill">‚öôÔ∏è Settings</div>
      <div id="btnFilter" class="pill">üîé Filter</div>
    </div>

    <!-- Chips (‡πÄ‡∏ï‡∏¥‡∏°‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô) -->
    <div class="chips" id="chipRow"></div>

    <!-- Card -->
    <div class="card-wrap">
      <div id="card" class="card enter">
        <div class="card-face card-front">
          <div id="c-kanji"  class="word-kanji">Áä¨</div>
          <div id="c-kana"   class="word-kana">„ÅÑ„Å¨</div>
          <div id="c-romaji" class="word-romaji">inu</div>
        </div>
        <div class="card-face card-back">
          <div id="c-meaning" class="meaning">‡∏™‡∏∏‡∏ô‡∏±‡∏Ç</div>
          <div class="meta">
            <span id="c-level"    class="meta-badge">N5</span>
            <span id="c-category" class="meta-badge">‡∏™‡∏±‡∏ï‡∏ß‡πå</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Flip full width -->
    <div id="btnFlip" class="flip-bar">Flip</div>
  </div>

  <!-- Bottom fixed actions -->
  <div class="bottom-bar">
    <div class="actions">
      <button id="btnKnow" class="btn btn-ok">‚úì Know</button>
      <button id="btnDont" class="btn btn-ng">‚úó Don't know</button>
    </div>
    <div class="row">
      <div id="btnPrev" class="ghost">‚Äπ ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</div>
      <div id="btnNext" class="ghost">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Ä∫</div>
      <div id="btnShuffle" class="ghost">üß© ‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà</div>
      <div id="btnStats" class="ghost">üìä ‡∏£‡∏µ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</div>
    </div>
  </div>
