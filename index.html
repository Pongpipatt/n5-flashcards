<!-- head -->
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>

<style>
:root{
  --bg:#F6F8FB; --surface:#FFFFFF;
  --ink:#0F172A; --ink-soft:#5B667A;
  --primary:#2A86FF; --success:#21C35B; --danger:#EF4D4D;
  --stroke:#E7ECF7;
  --shadow-sm:0 1px 2px rgba(15,23,42,.06), 0 1px 1px rgba(15,23,42,.03);
  --shadow-md:0 10px 24px rgba(15,23,42,.10);
  --r:12px; --r-lg:18px;
}

/* base */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;background:var(--bg);color:var(--ink);
  -webkit-font-smoothing:antialiased;
  font-family:'Noto Sans Thai','Noto Sans JP',system-ui,Arial,sans-serif;
}

/* app bar */
.appbar{position:sticky;top:0;z-index:20;display:flex;gap:12px;align-items:center;
  padding:12px 16px;background:var(--surface);border-bottom:1px solid var(--stroke)}
.app-title{margin:0;font-weight:800;letter-spacing:.2px;font-size:20px}
.counter-pill{background:#EDF4FF;color:#244A8A;border:1px solid var(--stroke);
  border-radius:999px;padding:6px 12px;font-weight:700}

/* layout */
.stage{padding:12px 16px 112px;max-width:920px;margin:0 auto}
.hint{padding:6px 16px 0;color:var(--ink-soft);font-size:14px}
.chip-row{display:flex;gap:8px;padding:8px 16px 0;overflow:auto}

/* card */
.card-wrap{display:grid;place-items:center;margin:8px 0 14px}
.card{
  width:min(760px,92vw);aspect-ratio:16/9;min-height:260px;background:var(--surface);
  border-radius:var(--r-lg);box-shadow:var(--shadow-md);position:relative;overflow:hidden;
  transform-style:preserve-3d;transition:transform .5s cubic-bezier(.2,.8,.2,1)
}
.card-face{position:absolute;inset:0;padding:28px 24px;display:flex;
  flex-direction:column;align-items:center;justify-content:center;backface-visibility:hidden}
.card.flipped{transform:rotateY(180deg)}
.card-back{transform:rotateY(180deg)}
.word-kanji{font-family:'Noto Sans JP',sans-serif;font-size:68px;font-weight:800}
.word-kana{font-family:'Noto Sans JP',sans-serif;font-size:22px;margin-top:6px;color:var(--ink-soft)}
.word-romaji{font-size:16px;color:#8B98B7;margin-top:2px}
.meaning{font-size:24px;font-weight:800;text-align:center}
.meta{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
.meta-badge{background:#EDF4FF;border:1px solid var(--stroke);padding:6px 10px;border-radius:999px;font-size:12px}

/* refined buttons (‡πÑ‡∏°‡πà‡∏ß‡∏á‡∏£‡∏µ, ‡∏°‡∏∏‡∏° 12px, padding ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö) */
.btn{
  appearance:none;border:none;border-radius:var(--r);
  padding:12px 16px;line-height:1;font-weight:800;cursor:pointer;
  box-shadow:var(--shadow-sm);background:var(--surface);color:var(--ink);
  transition:transform .06s ease, box-shadow .2s ease, opacity .2s ease, filter .2s ease;
}
.btn:active{transform:translateY(1px);box-shadow:none;filter:saturate(.96)}
.btn--fill{width:min(760px,92vw);display:block;margin:10px auto 6px;border:1px solid var(--stroke)}
.btn--success{background:var(--success);color:#fff}
.btn--danger{background:var(--danger);color:#fff}
.btn--primary{background:var(--primary);color:#fff}
.btn--ghost{background:var(--surface);border:1px solid var(--stroke)}
.btn .ripple{position:absolute;inset:0;border-radius:inherit;overflow:hidden;pointer-events:none}
.btn .ripple span{position:absolute;border-radius:50%;transform:scale(0);
  background:rgba(255,255,255,.45);animation:ripple .6s ease-out}
@keyframes ripple{to{transform:scale(10);opacity:0}}

/* footer action bar */
.action-footer{position:fixed;left:0;right:0;bottom:0;z-index:30;
  padding:12px clamp(12px,4vw,24px) calc(12px + env(safe-area-inset-bottom));
  background:linear-gradient(180deg, rgba(246,248,251,0) 0%, rgba(246,248,251,.95) 30%, rgba(246,248,251,1) 80%);
  backdrop-filter:saturate(140%) blur(6px);border-top:1px solid var(--stroke)}
.action-footer .row{max-width:920px;margin:0 auto;display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
.action-footer .row .btn{min-width:160px}

/* chips */
.chip{appearance:none;border:1px solid var(--stroke);background:var(--surface);
  padding:10px 12px;border-radius:10px;cursor:pointer;box-shadow:var(--shadow-sm)}
.chip:active{transform:translateY(1px);box-shadow:none}
.chip.outline{background:#F3F7FF}

/* page transition (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥) */
.card.enter{animation:slideIn .28s ease both}
.card.leave{animation:slideOut .22s ease both}
@keyframes slideIn{from{opacity:0;transform:translateY(8px) rotateY(0)}to{opacity:1;transform:translateY(0) rotateY(0)}}
@keyframes slideOut{from{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(-6px)}}

/* sheets / summary */
.sheet{width:min(780px,94vw);border:none;border-radius:16px;padding:0;box-shadow:var(--shadow-md)}
.sheet::backdrop{background:rgba(15,23,42,.35)}
.sheet-head{display:flex;align-items:center;gap:8px;padding:14px 16px;border-bottom:1px solid var(--stroke);background:var(--surface);border-radius:16px 16px 0 0}
.sheet-body{padding:16px 16px 6px;background:var(--surface);max-height:min(64vh,560px);overflow:auto}
.sheet-foot{padding:12px 16px;display:flex;gap:10px;justify-content:flex-end;background:var(--surface);border-top:1px solid var(--stroke);border-radius:0 0 16px 16px}
.pill-group{display:flex;gap:8px;flex-wrap:wrap}.pill{border:1px solid var(--stroke);background:var(--surface);padding:8px 12px;border-radius:999px;cursor:pointer}
.pill.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.subbar{position:sticky;top:0;z-index:9;background:var(--surface);display:flex;align-items:center;gap:8px;padding:12px 14px;border-bottom:1px solid var(--stroke)}
.stars-wrap{padding:14px 16px 120px;max-width:900px;margin:0 auto}
.star-group{background:var(--surface);border-radius:12px;box-shadow:var(--shadow-sm);padding:12px 12px 6px;margin-bottom:14px}
.word-chip{background:#F8FAFE;border:1px solid var(--stroke);border-radius:10px;padding:8px 10px;font-size:14px}

@media(min-width:960px){.word-kanji{font-size:76px}}
</style>
<!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î‚Ä¶ (‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°) -->
<button id="btnFlip" class="btn btn--fill btn--ghost">Flip</button>

<!-- footer ‡∏ï‡∏¥‡∏î‡∏•‡πà‡∏≤‡∏á -->
<div class="action-footer">
  <div class="row">
    <button id="btnKnow" class="btn btn--success">‚úì Know</button>
    <button id="btnDont" class="btn btn--danger">‚úï Don‚Äôt know</button>
  </div>
  <div class="row" style="margin-top:8px">
    <button id="btnPrev" class="chip">‚Äπ ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
    <button id="btnNext" class="chip">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Ä∫</button>
    <button id="btnShuffle" class="chip outline">üîÄ ‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà</button>
    <button id="btnStars" class="chip outline">üìä ‡∏£‡∏µ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</button>
  </div>
</div>
<script>
// ===== ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÄ‡∏ö‡∏¥‡∏•‡πÅ‡∏ó‡πá‡∏õ‡∏ã‡∏π‡∏° / ‡∏û‡∏¥‡∏ô‡∏ä‡πå‡∏ö‡∏ô iOS =====
let lastTouch=0;
document.addEventListener('touchend',e=>{
  const now=Date.now();
  if(now-lastTouch<=300){e.preventDefault()}
  lastTouch=now;
},{passive:false});
document.addEventListener('gesturestart',e=>e.preventDefault());

// ===== helper: ‡∏ó‡∏≥ ripple ‡πÄ‡∏ö‡∏≤ ‡πÜ ‡∏ï‡∏≠‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° =====
function addRipple(btn,e){
  const wrap = btn.querySelector('.ripple') || (()=>{const r=document.createElement('span');r.className='ripple';btn.appendChild(r);return r})();
  const dot=document.createElement('span');
  const rect=btn.getBoundingClientRect();
  const x=(e.clientX||rect.width/2)-rect.left; const y=(e.clientY||rect.height/2)-rect.top;
  dot.style.left=x+'px'; dot.style.top=y+'px'; dot.style.width=dot.style.height=Math.max(rect.width,rect.height)+'px';
  wrap.appendChild(dot); setTimeout(()=>dot.remove(), 620);
}
['btnFlip','btnKnow','btnDont','btnPrev','btnNext','btnShuffle','btnStars']
  .forEach(id=>{
    const el=document.getElementById(id);
    if(!el) return;
    el.addEventListener('click',ev=>addRipple(el,ev));
  });

// ===== animation ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥ (slide in/out) =====
const card = document.querySelector('.card');
function animateChange(fn){
  if(!card) return fn();
  card.classList.remove('enter');
  card.classList.add('leave');
  setTimeout(()=>{
    fn();                    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ renderCard() ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÅ‡∏ó‡∏ô)
    card.classList.remove('leave');
    void card.offsetWidth;   // force reflow
    card.classList.add('enter');
  }, 180);
}

// Hook ‡∏õ‡∏∏‡πà‡∏° next/prev ‡∏Å‡∏±‡∏ö animateChange
document.getElementById('btnNext')?.addEventListener('click',()=>{
  animateChange(()=> goNext()); // ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà goNext() ‡∏î‡πâ‡∏ß‡∏¢‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
});
document.getElementById('btnPrev')?.addEventListener('click',()=>{
  animateChange(()=> goPrev());
});

// Flip ‡∏Å‡∏≤‡∏£‡πå‡∏î (‡∏¢‡∏±‡∏á‡∏Ñ‡∏á tap ‡πÄ‡∏û‡∏∑‡πà‡∏≠ flip ‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
const btnFlip=document.getElementById('btnFlip');
btnFlip?.addEventListener('click',()=> card?.classList.toggle('flipped'));
card?.addEventListener('click',()=> card?.classList.toggle('flipped'));

// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏ä‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ animation ‡∏Å‡πâ‡∏≠‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
document.getElementById('btnShuffle')?.addEventListener('click',()=>{
  animateChange(()=> reshuffle()); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
});
</script>
