<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>N5 Flashcards — Lilac Mobile v2</title>
<style>
  :root{
    --lilac:#b79df4; --lilac-2:#ece6ff; --lilac-3:#f7f4ff;
    --ink:#1b2230; --ok:#2bbb73; --bad:#e05353; --card:#ffffff;
    --shadow: 0 10px 30px rgba(0,0,0,.08); --radius:18px;
  }
  html,body{height:100%; margin:0; overflow:hidden; background:
    radial-gradient(1200px 600px at 0% 100%, var(--lilac-2), transparent 60%),
    radial-gradient(1200px 600px at 100% 0%, var(--lilac-2), transparent 60%),
    var(--lilac-3);
    font-family: ui-sans-serif,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans";
    color:var(--ink); -webkit-tap-highlight-color:transparent;
  }
  .app{
    height: calc(100svh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
    padding:
      calc(8px + env(safe-area-inset-top))
      calc(12px + env(safe-area-inset-right))
      calc(12px + env(safe-area-inset-bottom))
      calc(12px + env(safe-area-inset-left));
    display:flex; flex-direction:column; gap:12px; box-sizing:border-box;
  }
  .header{display:flex; align-items:center; justify-content:space-between;}
  .brand{display:flex; align-items:center; gap:10px; font-weight:800}
  .badge{background:var(--lilac); color:#fff; width:36px; height:36px; border-radius:10px;
    display:grid; place-items:center; box-shadow:var(--shadow)}
  .menu{
    width:40px; height:40px; border-radius:12px; display:grid; place-items:center;
    background:#fff7; backdrop-filter:saturate(120%) blur(4px); box-shadow:var(--shadow);
  }
  .menu div{width:18px; height:2px; background:#444; border-radius:2px; position:relative}
  .menu div:before,.menu div:after{content:""; position:absolute; left:0; right:0; height:2px; background:#444; border-radius:2px}
  .menu div:before{top:-6px} .menu div:after{top:6px}

  .stage{flex:1; display:flex; flex-direction:column; align-items:center; gap:12px}

  .card-wrap{flex:1; width:100%; display:grid; place-items:center; perspective:1200px}
  .card{
    width:min(980px, 95vw);
    height:min(58svh, 70vw);
    border-radius:calc(var(--radius) + 6px);
    box-shadow:var(--shadow), inset 0 0 0 1px rgba(0,0,0,.04);
    position:relative;
    background:var(--card);
    transition: background-color .25s ease, box-shadow .25s ease;
  }
  .card-inner{
    position:absolute; inset:0; border-radius:inherit; transform-style:preserve-3d;
    transition: transform .45s cubic-bezier(.2,.7,.2,1);
    display:grid; place-items:center;
  }
  .face{
    position:absolute; inset:0; backface-visibility:hidden; border-radius:inherit;
    display:grid; place-items:center; text-align:center; padding:14px;
  }
  .front .main{font-weight:800; font-size: clamp(34px, 8.5vw, 80px)}
  .back  .main{font-weight:700; font-size: clamp(22px, 5.2vw, 36px)}
  .back  .sub1{font-size: clamp(16px, 4vw, 22px); opacity:.9; margin-top:8px}
  .back  .sub2{font-size: clamp(14px, 3.6vw, 18px); opacity:.85; margin-top:6px}
  .back{transform:rotateY(180deg)}

  .flipped .card-inner{ transform: rotateY(180deg) }

  /* swipe feedback */
  .tint-ok{ background:#f1fbf6 !important; box-shadow:var(--shadow), 0 0 0 4px rgba(43,187,115,.18) inset }
  .tint-bad{ background:#fff5f6 !important; box-shadow:var(--shadow), 0 0 0 4px rgba(224,83,83,.18) inset }

  .mark{
    position:absolute; top:12px; right:12px; width:40px; height:40px; border-radius:50%;
    display:grid; place-items:center; font-weight:900; color:#fff; opacity:0; transform:scale(.8);
    transition: opacity .2s ease, transform .2s ease;
  }
  .mark.ok{ background:var(--ok) } .mark.bad{ background:var(--bad) }
  .show-ok .mark.ok{ opacity:1; transform:scale(1) }
  .show-bad .mark.bad{ opacity:1; transform:scale(1) }

  .actions{display:grid; grid-template-columns:1fr 1fr; gap:12px; width:min(960px, 96vw)}
  .btn{
    padding:16px 18px; border:none; border-radius:20px; color:#fff; font-weight:800;
    font-size: clamp(15px, 3.8vw, 18px); box-shadow:var(--shadow); cursor:pointer; touch-action:manipulation;
  }
  .btn-ok{background:var(--ok)} .btn-bad{background:var(--bad)}
  .footer{text-align:center; font-size:12px; opacity:.55}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="brand">
      <div class="badge">N5</div><div>N5 Flashcards</div>
    </div>
    <div class="menu" aria-label="menu"><div></div></div>
  </div>

  <div class="stage">
    <div class="card-wrap">
      <div class="card" id="card">
        <div class="card-inner" id="cardInner">
          <div class="face front">
            <div>
              <div class="main" id="frontMain">Loading…</div>
            </div>
          </div>
          <div class="face back">
            <div>
              <div class="main" id="backMain">—</div>
              <div class="sub1" id="backSub1"></div>
              <div class="sub2" id="backSub2"></div>
            </div>
          </div>
        </div>
        <div class="mark ok">✓</div>
        <div class="mark bad">✗</div>
      </div>
    </div>

    <div class="actions">
      <button class="btn btn-ok"  id="btnKnow">✓ Know</button>
      <button class="btn btn-bad" id="btnDont">✗ Don’t know</button>
    </div>
    <div class="footer">Tap = flip · Swipe right = Know · Swipe left = Don’t know</div>
  </div>
</div>

<script>
/* ใช้ลิงก์ RAW ของโกโก้ */
const DATA_URL = 'https://raw.githubusercontent.com/Pongpipatt/n5-flashcards/refs/heads/main/n5-n4-core-1000.json';

let cards=[], i=0, flipped=false;
let startX=0, startY=0, swiping=false;

const $ = sel => document.querySelector(sel);
const $card = $('#card'), $inner = $('#cardInner');
const $front = $('#frontMain'), $back = $('#backMain'), $b1 = $('#backSub1'), $b2 = $('#backSub2');

function norm(row){
  const front = row.kanji || row.kana || row.word || '—';
  const b1 = row.kana || '';
  const b2 = (row.romaji || '') + (row.romaji && (row.meaning||row.thai)?' · ':'') + (row.meaning || row.thai || '');
  return {front,b1,b2};
}

function render(){
  const c = cards[i]; if(!c) return;
  // reset tint & marks every render
  $card.classList.remove('tint-ok','tint-bad','show-ok','show-bad');
  $front.textContent = c.front;
  $back.textContent  = c.front; // ต้องการให้เห็นคันจิ/ตัวคำบนหลังด้วย
  $b1.textContent    = c.b1;
  $b2.textContent    = c.b2;
  setFlip(false);
}
function setFlip(v){
  flipped=v;
  if(flipped) $card.classList.add('flipped'); else $card.classList.remove('flipped');
}
function next(){
  i = (i+1) % cards.length;
  render();
}

function know(){
  $card.classList.add('tint-ok','show-ok');
  setTimeout(next, 170);
}
function dont(){
  $card.classList.add('tint-bad','show-bad');
  // ใบนี้โยนไปท้ายกอง
  const cur = cards[i]; cards.splice(i,1); cards.push(cur);
  if(i>=cards.length) i=0;
  setTimeout(next, 170);
}

/* Touch / Swipe */
$card.addEventListener('touchstart', e=>{
  const t=e.changedTouches[0]; startX=t.clientX; startY=t.clientY; swiping=true;
},{passive:true});
$card.addEventListener('touchmove', e=>{
  if(!swiping) return;
  const t=e.changedTouches[0]; const dx=t.clientX-startX; const dy=t.clientY-startY;
  // แสดงการลากนิดหน่อย
  $card.style.transform = `translateX(${Math.max(Math.min(dx,90),-90)}px) rotate(${dx/90*2}deg)`;
},{passive:true});
$card.addEventListener('touchend', e=>{
  if(!swiping) return; swiping=false;
  const t=e.changedTouches[0]; const dx=t.clientX-startX; const dy=t.clientY-startY;
  $card.style.transform='translateX(0) rotate(0)';
  const TH=60;
  if(Math.abs(dx)<TH && Math.abs(dy)<40){ setFlip(!flipped); return; }
  if(dx>TH) know(); else if(dx<-TH) dont();
});

// Desktop click = flip
$card.addEventListener('click', ()=> setFlip(!flipped));
$('#btnKnow').addEventListener('click', know);
$('#btnDont').addEventListener('click', dont);

/* Load data */
(async ()=>{
  try{
    const r = await fetch(DATA_URL,{cache:'no-store'});
    const arr = await r.json();
    cards = (Array.isArray(arr)?arr:arr.data).map(norm).filter(x=>x.front.trim());
    // สุ่มเล็กน้อย
    for(let k=cards.length-1;k>0;k--){ const j=Math.floor(Math.random()*(k+1)); [cards[k],cards[j]]=[cards[j],cards[k]]; }
    i=0; render();
  }catch(e){
    $front.textContent='Load failed'; console.error(e);
  }
})();
</script>
</body>
</html>
